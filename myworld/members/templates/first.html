<!DOCTYPE html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.js" integrity="sha512-Lii3WMtgA0C0qmmkdCpsG0Gjr6M0ajRyQRQSbTF6BsrVh/nhZdHpVZ76iMIPvQwz1eoXC3DmAg9K51qT5/dEVg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<link rel="stylesheet" href="../static/styles.css">
<body>
  <h1>Welcome to the home page of django web application!</h1>
  <p>Testing the forms for taking in queries by the employess of Reshamandi company.</p>
    
<div ng-app="myApp" ng-controller="formCtrl">
  <form novalidate action="" method="POST"> 
    {% csrf_token %}
   <h2>PRODUCT SPECIFICATIONS</h2>  <br>

    Type:
    <select ng-model="product.type" name="type" multiple size="3">
      <option value="">All</option>
      {% for i in formData.types %}
      <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select> <br> <br> 

    Category:
      <select ng-model="product.category" name="category" multiple size="3">
        <option value="">All
        {% for i in formData.categories %}
        <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select> <br> <br> 

    Color:
    <select ng-model="product.color" name="color" multiple size="3">
      <option value="">All
        {% for i in formData.colors %}
        <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select> <br> <br>

    Border:
    <select ng-model="product.border" name="border" multiple size="3">
      <option value="">All
        {% for i in formData.borders %}
        <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select> <br> <br> 
      <input type="hidden" name="switch" value="product">
      <input type="submit" value="Search">
      </form>

      <form novalidate action="" method="POST"> 
        {% csrf_token %}
    <h2>TRANSACTION DETAILS</h2> <br>
    Month of transaction:
    <select ng-model="user.month" name="month" multiple size="3">
      <option value="">All
        {% for i in formData.months %}
        <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select> <br> <br> 
   
      Centre: 
      <select ng-model="user.center" name="centre" multiple size="3">
        <option value="">All
          {% for i in formData.centres %}
          <option value="{{ i }}">{{ i }}</option>
          {% endfor %}
        </select> <br> <br> 

    Rating:
    <select ng-model="user.rating" name="rating" multiple size="3">
      <option value="">All
        {% for i in formData.ratings %}
        <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select> <br> <br> 

      Weaver ID:
      <input type="text" ng-model="user.weaver_id" name="wids">
      <br><br>
    <input type="hidden" name="switch" value="transaction">
    <input type="submit" value="Search">
    <button ng-click="reset()">RESET</button><br>
  </form>

  <br>
  {% if count %}
  Number of transactions is : {{ count }}
  {% endif %}
  <br>

  {% if wids %}
  <centre><canvas id="myChart" width="50" height="10" ></canvas></centre> 
  {% endif %}

  {% if table %}
    <h2>Table is :</h2> <br>
    <table class="transactions">
      <thead>
        <tr>
          <th>Weaver_id</th>
          <th>Quantity</th>
          <th>Month</th>
          <th>Centre</th>
          <th>Rating</th>
          <th>Product</th>
        </tr>
      </thead>
      <tbody>
        {% for tran in table %}
        <tr>
          {% for key,value in tran.items %}
          <td>{{ value }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  {% if top.wids %}
    <div >
      <table>
        <thead>
          <tr>
            <th>Weaver_id</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          {% for wid,qt in top.wids %}
          <tr>
            <td>{{ wid }}</td>
            <td>{{ qt }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          {% for pdt,qt in top.pdts %}
          <tr>
            <td>{{ pdt }}</td>
            <td>{{ qt }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
  <input type="hidden" id="myVar" name="variable" value="{{ topWid }}">
  <input type="hidden" id="myVar2" name="variable" value="{{ topPdt }}">
</div>

<script type="text/javascript">
var app = angular.module('myApp', []);
app.controller('formCtrl', function($scope) {
    $scope.Pmaster = {type: "",category:"",color:"",border:""};
    $scope.Tmaster = {month: "",rating:"",weaver_id:"",center:""};
    $scope.reset = function() {
        $scope.user = angular.copy($scope.Tmaster);
        $scope.product = angular.copy($scope.Pmaster);
    };
    $scope.reset();
});
var quantity = "{{chartMonth}}";
var wids = "{{wids}}";
var topWid = document.getElementById("myVar").value;
var qtWid = "{{qtWid}}";
var topPdt = document.getElementById("myVar2").value;
var qtPdt = "{{qtPdt}}";
if(wids)var Wids = JSON.parse(wids);
if(quantity)var Quantity = JSON.parse(quantity);
if(topWid)console.log(topWid);
if(qtWid)console.log(JSON.parse(qtWid));
if(topPdt)console.log(topPdt);
if(qtPdt)console.log(JSON.parse(qtPdt));


const plugin = {
  id: 'custom_canvas_background_color',
  beforeDraw: (chart) => {
    const ctx = chart.canvas.getContext('2d');
    ctx.save();
    ctx.globalCompositeOperation = 'destination-over';
    ctx.fillStyle = 'lightBlack';
    ctx.fillRect(0, 0, chart.width, chart.height);
    ctx.restore();
  }
};
console.log(Wids);
console.log(typeof(Wids));
console.log(Quantity);
console.log(typeof(Quantity));
var DATA = []
if(Wids.length){
  console.log("Chexck");
for(let i = 0; i<Wids.length;i++){
  // var Quantity = quantity[i];
  var obj = {
    label: Wids[i],
          data: Quantity[i],
          backgroundColor: [
              'rgba(255, 99, 132, 0.5)',
              'rgba(54, 162, 235, 0.5)',
              'rgba(255, 206, 86, 0.5)',
              'rgba(75, 192, 192, 0.5)',
              'rgba(153, 102, 255, 0.5)',
              'rgba(255, 159, 64, 0.5)'
          ],
          borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)',
              'rgba(255, 159, 64, 1)'
          ],
          hoverOffset: 5,
          borderWidth: 1,
          tension: 0.4,
  }
  DATA.push(obj);
}


let Labels = ['January','February','March','April','May','June','July','August','September','October','November','December'];

const ctx = document.getElementById('myChart').getContext('2d');
const myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: Labels,
        datasets: DATA,
    },
    plugins: [plugin],
    options: {
        plugins: {
            title: {
                display: true,
                text: 'Quantity vs Month'
            },

        },
        scales: {
            y: {
                beginAtZero: false
            }
        }
    
    }
});
}
</script>

</body>
</html>
